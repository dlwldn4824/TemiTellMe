# 🤖 테미 로봇 웹뷰 앱 설치 및 실행 가이드

이 가이드는 테미 로봇에 웹뷰 앱을 설치하고 웹 애플리케이션을 표시하는 전체 과정을 순서대로 설명합니다.

---

## 📋 사전 준비사항

- ✅ 테미 로봇과 개발 PC가 같은 Wi-Fi 네트워크에 연결되어 있어야 합니다
- ✅ Android Debug Bridge (adb)가 설치되어 있어야 합니다
- ✅ Node.js와 pnpm이 설치되어 있어야 합니다
- ✅ Java JDK 17 이상이 설치되어 있어야 합니다

---

## 🚀 단계별 실행 가이드

### 1단계: 개발 PC의 IP 주소 확인

로봇에서 접근할 수 있는 개발 PC의 IP 주소를 확인합니다.

```bash
# macOS/Linux
ifconfig | grep "inet " | grep -v 127.0.0.1

# Windows
ipconfig
```

**예시 출력:**
```
inet 192.168.0.100 netmask 0xffffff00 broadcast 192.168.0.255
```

이 IP 주소를 기록해두세요. (예: `192.168.0.100`)

---

### 2단계: 웹 애플리케이션 빌드

프로젝트 루트 디렉토리에서 웹 앱을 빌드합니다.

```bash
cd /Users/LEEJIWOO/Desktop/TemiTellMe/co-show
pnpm run build
```

빌드가 완료되면 `dist/` 폴더에 빌드된 파일이 생성됩니다.

---

### 3단계: Capacitor로 안드로이드에 복사

빌드된 웹 파일을 안드로이드 프로젝트의 assets 폴더로 복사합니다.

```bash
npx cap copy android
```

이 명령어는 `dist/` 폴더의 내용을 `android/app/src/main/assets/public/`로 복사합니다.

---

### 4단계: 개발 서버 실행 (선택사항)

**옵션 A: 개발 서버 사용 (실시간 개발용)**

개발 서버를 실행하여 실시간으로 변경사항을 확인할 수 있습니다.

```bash
# 프론트엔드 개발 서버 실행
cd /Users/LEEJIWOO/Desktop/TemiTellMe/co-show
pnpm run dev
```

서버가 시작되면 터미널에 다음과 같은 메시지가 표시됩니다:
```
➜  Local:   http://localhost:5173/
➜  Network: http://192.168.0.100:5173/  ← 이 주소를 사용!
```

**Network 주소**를 기록해두세요.

> **참고:** Network 주소가 표시되지 않으면 `vite.config.js`에 `server.host: "0.0.0.0"` 설정이 있는지 확인하세요. (이미 설정되어 있습니다)

**옵션 B: 로컬 빌드 파일 사용 (프로덕션용)**

개발 서버 없이 빌드된 파일을 직접 사용합니다. (3단계에서 이미 복사 완료)

---

### 5단계: 백엔드 서버 실행

백엔드 서버를 실행합니다. (별도 터미널에서)

```bash
cd /Users/LEEJIWOO/Desktop/TemiTellMe/co-show/backend
npm run dev
```

백엔드 서버가 실행되면 WebSocket 통신이 가능합니다.

---

### 6단계: 테미 로봇 연결

테미 로봇의 IP 주소로 adb 연결을 설정합니다.

```bash
# 로봇 IP 주소로 연결 (예: 10.200.57.107)
adb connect 10.200.57.107:5555

# 연결 확인
adb devices
```

**예상 출력:**
```
List of devices attached
10.200.57.107:5555	device
```

✅ **"device"가 표시되면 연결 성공!**

> **참고:** 로봇 IP 주소는 로봇 화면에서 확인하거나 네트워크 설정에서 확인할 수 있습니다.

---

### 7단계: APK 빌드

안드로이드 앱을 빌드합니다.

```bash
cd /Users/LEEJIWOO/Desktop/TemiTellMe/co-show/android
./gradlew assembleDebug
```

빌드가 완료되면 `app/build/outputs/apk/debug/app-debug.apk` 파일이 생성됩니다.

> **참고:** 첫 빌드 시 시간이 오래 걸릴 수 있습니다.

---

### 8단계: APK 설치

빌드된 APK를 테미 로봇에 설치합니다.

```bash
cd /Users/LEEJIWOO/Desktop/TemiTellMe/co-show/android
adb install -r app/build/outputs/apk/debug/app-debug.apk
```

**예상 출력:**
```
Performing Streamed Install
Success
```

✅ **"Success"가 표시되면 설치 완료!**

> **참고:** 기존에 설치된 앱이 있다면 `-r` 옵션으로 덮어쓰기됩니다.

---

### 9단계: 앱 실행

설치된 앱을 실행합니다.

```bash
adb shell am start -n com.example.coshowsample/.MainActivity
```

또는 **로봇 화면에서 직접 앱 아이콘을 터치**해도 됩니다.

---

### 10단계: 확인

앱이 실행되면:

1. ✅ WebView가 웹 애플리케이션을 로드합니다
2. ✅ 웹 앱 화면이 로봇 화면에 표시됩니다
3. ✅ 잠시 로딩 시간이 있을 수 있습니다

---

## 🔧 설정 변경 (필요한 경우)

### 개발 서버 URL 사용하기

`capacitor.config.json` 파일에서 개발 서버 URL을 설정할 수 있습니다:

```json
{
  "appId": "com.example.coshowsample",
  "appName": "co-show",
  "webDir": "dist",
  "server": {
    "androidScheme": "http",
    "url": "http://192.168.0.100:5173/",
    "cleartext": true
  }
}
```

> **주의:** `url`의 IP 주소를 1단계에서 확인한 개발 PC의 IP 주소로 변경하세요.

### 로컬 파일 사용하기

`MainActivity.java`에서 로컬 파일을 로드하도록 설정되어 있습니다:

```java
webView.loadUrl("file:///android_asset/www/index.html");
```

개발 서버를 사용하려면 이 부분을 수정해야 합니다.

---

## 🔍 문제 해결

### 문제 1: "adb: no devices/emulators found"

**원인:** 로봇이 연결되지 않음

**해결:**
```bash
# 로봇 IP 주소 확인 후 재연결
adb connect <로봇_IP>:5555
adb devices
```

**확인 사항:**
- 로봇과 PC가 같은 Wi-Fi 네트워크에 연결되어 있는지 확인
- 로봇의 IP 주소가 올바른지 확인
- 로봇에서 개발자 모드가 활성화되어 있는지 확인

---

### 문제 2: 화면이 검은색이거나 로딩만 계속됨

**원인:** 웹 리소스를 로드할 수 없음

**해결:**

1. **로컬 파일 사용하는 경우:**
   ```bash
   # 빌드 및 복사 재실행
   cd /Users/LEEJIWOO/Desktop/TemiTellMe/co-show
   pnpm run build
   npx cap copy android
   ```

2. **개발 서버 사용하는 경우:**
   - 개발 서버가 실행 중인지 확인
   - IP 주소가 올바른지 확인
   - 방화벽이 포트를 차단하지 않는지 확인

---

### 문제 3: "INSTALL_FAILED_INVALID_APK"

**원인:** APK 파일이 손상되었거나 호환되지 않음

**해결:**
```bash
# 기존 앱 제거 후 재설치
adb uninstall com.example.coshowsample
adb install app/build/outputs/apk/debug/app-debug.apk
```

---

### 문제 4: "ERR_CONNECTION_REFUSED" 또는 네트워크 오류

**원인:** 개발 서버에 접근할 수 없음

**해결:**

1. 개발 서버가 실행 중인지 확인:
   ```bash
   lsof -i :5173
   ```

2. Vite 서버가 외부 접근을 허용하는지 확인:
   `vite.config.js`에 다음 설정 추가:
   ```javascript
   export default defineConfig({
     plugins: [react()],
     base: "./",
     build: {
       outDir: "dist",
     },
     server: {
       host: "0.0.0.0",  // 외부 접근 허용
       port: 5173,
     },
   });
   ```

3. 서버 재시작:
   ```bash
   pnpm run dev
   ```

---

### 문제 5: WebSocket 연결 실패

**원인:** 백엔드 서버에 접근할 수 없음

**해결:**

1. 백엔드 서버가 실행 중인지 확인:
   ```bash
   lsof -i :4000
   ```

2. `TemiSocketManager.java`의 서버 URL 확인:
   ```java
   socketManager.setServerUrl("http://<개발_PC_IP>:4000");
   ```

3. 백엔드 서버 재시작:
   ```bash
   cd /Users/LEEJIWOO/Desktop/TemiTellMe/co-show/backend
   npm run dev
   ```

---

## 📋 전체 명령어 체크리스트

다음 명령어들을 순서대로 실행하세요:

```bash
# 1. IP 주소 확인
ifconfig | grep "inet " | grep -v 127.0.0.1

# 2. 웹 앱 빌드
cd /Users/LEEJIWOO/Desktop/TemiTellMe/co-show
pnpm run build

# 3. 안드로이드에 복사
npx cap copy android

# 4. 개발 서버 실행 (선택사항 - 별도 터미널)
pnpm run dev

# 5. 백엔드 서버 실행 (선택사항 - 별도 터미널)
cd backend
npm run dev

# 6. 로봇 연결
adb connect 10.200.57.107:5555
adb devices

# 7. APK 빌드
cd android
./gradlew assembleDebug

# 8. APK 설치
adb install -r app/build/outputs/apk/debug/app-debug.apk

# 9. 앱 실행
adb shell am start -n com.example.coshowsample/.MainActivity
```

---

## 📱 로봇에서 직접 실행하는 방법

앱이 설치되면 로봇 화면에서도 직접 실행할 수 있습니다:

1. 로봇 화면에서 홈 화면으로 이동
2. 앱 목록에서 "co-show" 또는 "coshowsample" 찾기
3. 앱 아이콘 터치

---

## 🔍 로그 확인 (디버깅용)

앱 실행 중 문제가 발생하면 로그를 확인하세요:

```bash
# WebView 로그
adb logcat | grep -i "webview\|chromium"

# 앱 로그
adb logcat | grep -i "coshowsample\|MainActivity"

# WebSocket 로그
adb logcat | grep -i "TemiSocketManager"

# 모든 앱 로그
adb logcat | grep "com.example.coshowsample"
```

---

## ✅ 정상 작동 확인 체크리스트

- [ ] 로봇이 `adb devices`에 표시됨
- [ ] 웹 앱 빌드 완료 (`dist/` 폴더 생성)
- [ ] Capacitor 복사 완료 (`android/app/src/main/assets/public/` 확인)
- [ ] APK 빌드 완료 (`app-debug.apk` 생성)
- [ ] APK 설치 완료 (`Success` 메시지)
- [ ] 앱 실행 성공
- [ ] 로봇 화면에 웹 앱 화면이 표시됨
- [ ] (선택) 개발 서버 실행 중 (실시간 개발용)
- [ ] (선택) 백엔드 서버 실행 중 (WebSocket 통신용)

---

## 💡 팁

### IP 주소가 바뀌었을 때

네트워크를 바꾸면 IP 주소가 변경될 수 있습니다. 다음 파일들의 IP 주소를 업데이트하세요:

1. `capacitor.config.json` - `server.url`
2. `MainActivity.java` - `socketManager.setServerUrl()` (WebSocket URL)
3. `src/services/apiBase.js` - API 베이스 URL (안드로이드 환경)

### 빠른 재설치

코드 변경 후 빠르게 재설치하려면:

```bash
# 웹 앱만 변경된 경우
cd /Users/LEEJIWOO/Desktop/TemiTellMe/co-show
pnpm run build
npx cap copy android
cd android
./gradlew assembleDebug
adb install -r app/build/outputs/apk/debug/app-debug.apk
```

### 개발 서버 사용 시

개발 서버를 사용하면 코드 변경 시 자동으로 반영됩니다. (Hot Module Replacement)

---

## 🎯 다음 단계

앱이 정상적으로 실행되면:

1. 웹 앱 기능 테스트
2. Temi SDK 기능 테스트 (이동, 말하기 등)
3. WebSocket 통신 확인
4. API 호출 확인
5. 카메라 기능 테스트 (사진 촬영 등)

---

## 📞 추가 도움말

문제가 계속 발생하면 다음 파일들을 참고하세요:

- `앱_실행_가이드.md` - 상세한 문제 해결 가이드
- `최종_설치_가이드.md` - 로컬 빌드 파일 사용 가이드
- `ANDROID_SETUP.md` - Android 설정 가이드

---

**행운을 빕니다! 🚀**


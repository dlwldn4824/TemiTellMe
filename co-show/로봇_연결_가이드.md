# 로봇에 로컬 웹 서버 연결 가이드

로봇(Temi)에서 개발 PC의 로컬 웹 서버에 접근하여 앱을 실행하는 방법입니다.

## 📋 사전 준비

1. **로봇과 개발 PC가 같은 네트워크에 연결되어 있어야 합니다**
2. **개발 PC의 IP 주소 확인** (예: `10.200.57.108`)

---

## 🚀 단계별 설정

### 1️⃣ 개발 PC IP 확인

```bash
# macOS/Linux
ifconfig | grep "inet " | grep -v 127.0.0.1

# Windows
ipconfig
```

예시 출력:
```
inet 10.200.57.108 netmask 0xffff0000
```
→ 이 IP 주소를 메모해두세요!

---

### 2️⃣ Vite 개발 서버 설정 (외부 접근 허용)

✅ 이미 설정 완료됨 (`vite.config.js`)
- `server.host: "0.0.0.0"` 설정으로 외부 접근 허용

---

### 3️⃣ 개발 서버 시작

**터미널 1: 프론트엔드 개발 서버**

```bash
cd co-show
pnpm run dev
```

출력 예시:
```
VITE v5.x.x ready in xxx ms

➜  Local:   http://localhost:5173/
➜  Network: http://10.200.57.108:5173/
```

✅ `Network` 주소(`http://10.200.57.108:5173`)를 확인하세요!

**터미널 2: 백엔드 서버**

```bash
cd co-show/backend
npm run dev
```

서버가 `http://localhost:4000` (또는 설정한 포트)에서 실행됩니다.

---

### 4️⃣ 안드로이드 앱 설정 확인

#### 4-1. MainActivity.java 확인

`co-show/android/app/src/main/java/com/example/coshowsample/MainActivity.java`:

```java
// 웹뷰가 로드할 URL (개발 서버 주소)
private static final String ENTRY_URL = "http://10.200.57.108:5173";

// WebSocket 서버 URL (백엔드 주소)
socketManager.setServerUrl("http://10.200.57.108:4000");
```

⚠️ **중요**: IP 주소(`10.200.57.108`)를 실제 개발 PC IP로 변경하세요!

#### 4-2. API Base URL 확인

`co-show/src/services/apiBase.js`:

```javascript
if (typeof navigator !== "undefined" && /Android/i.test(navigator.userAgent)) {
  return "http://10.200.57.108:4000";  // 실제 로봇용 IP
}
```

---

### 5️⃣ 앱 빌드 및 설치

#### 5-1. 웹 앱 빌드 (선택사항)

로컬 assets를 사용하지 않고 개발 서버를 사용하므로 **빌드 불필요**합니다.

하지만 빌드하려면:
```bash
cd co-show
pnpm run build
```

#### 5-2. Android APK 빌드

```bash
cd co-show/android

# Java 경로 설정
export JAVA_HOME="/Applications/Android Studio.app/Contents/jbr/Contents/Home"
export PATH="$JAVA_HOME/bin:$PATH"

# APK 빌드
./gradlew assembleDebug
```

#### 5-3. 로봇 연결 확인

```bash
adb devices
```

출력 예시:
```
List of devices attached
10.200.57.107:5555	device
```

✅ 로봇이 연결되어 있는지 확인하세요!

#### 5-4. APK 설치

```bash
adb install -r app/build/outputs/apk/debug/app-debug.apk
```

---

## ✅ 테스트

1. **앱 실행**
   ```bash
   adb shell am start -n com.example.coshowsample/.MainActivity
   ```

2. **확인 사항**:
   - ✅ 웹뷰가 개발 서버(`http://10.200.57.108:5173`)를 로드하는지 확인
   - ✅ 백엔드 API 호출이 정상 작동하는지 확인
   - ✅ WebSocket 연결이 정상인지 확인 (앱 로그 확인)

---

## 🔧 문제 해결

### 문제 1: "네트워크 오류" 또는 "연결할 수 없음"

**원인**: 개발 PC 방화벽이 포트를 차단하고 있거나, Vite 서버가 외부 접근을 허용하지 않음

**해결**:
1. Vite 설정 확인 (`vite.config.js`에 `server.host: "0.0.0.0"` 있는지 확인)
2. 개발 서버 재시작
3. 개발 PC와 로봇이 같은 네트워크에 있는지 확인

---

### 문제 2: API 호출 실패 (404 또는 연결 오류)

**원인**: `apiBase.js`의 IP 주소가 잘못되었거나, 백엔드 서버가 실행되지 않음

**해결**:
1. 백엔드 서버가 실행 중인지 확인
2. `apiBase.js`의 IP 주소를 실제 개발 PC IP로 변경
3. `MainActivity.java`의 WebSocket URL도 동일한 IP로 설정

---

### 문제 3: WebSocket 연결 실패

**원인**: 백엔드 서버 IP가 잘못되었거나, 서버가 WebSocket을 지원하지 않음

**해결**:
1. 백엔드 서버가 실행 중인지 확인
2. `MainActivity.java`의 `setServerUrl()` 호출 확인
3. 로봇 로그 확인:
   ```bash
   adb logcat | grep TemiSocketManager
   ```

---

## 📝 네트워크 설정 요약

| 항목 | 주소 | 설명 |
|------|------|------|
| **웹뷰 URL** | `http://10.200.57.108:5173` | Vite 개발 서버 (프론트엔드) |
| **API Base URL** | `http://10.200.57.108:4000` | 백엔드 REST API |
| **WebSocket URL** | `http://10.200.57.108:4000` | 백엔드 WebSocket |

⚠️ **모든 IP 주소(`10.200.57.108`)를 실제 개발 PC IP로 변경하세요!**

---

## 🎯 다음 단계

1. 로봇에서 앱이 정상 작동하는지 확인
2. Temi SDK 기능 테스트 (이동, 말하기 등)
3. WebSocket 통신 확인
4. 필요시 프로덕션 빌드로 전환



